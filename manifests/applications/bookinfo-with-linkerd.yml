# Bookinfo 애플리케이션 with Linkerd Injection
# Based on: https://raw.githubusercontent.com/istio/istio/release-1.20/samples/bookinfo/platform/kube/bookinfo.yaml
#
# 주요 변경사항:
# 1. Namespace에 linkerd.io/inject: enabled 추가
# 2. productpage Service를 NodePort 30080으로 설정
# 3. Self-managed 환경에 최적화된 리소스 요청량

---
apiVersion: v1
kind: Namespace
metadata:
  name: bookinfo
  annotations:
    linkerd.io/inject: enabled
  labels:
    name: bookinfo

---
# productpage Service (NodePort for external access)
apiVersion: v1
kind: Service
metadata:
  name: productpage
  namespace: bookinfo
  labels:
    app: productpage
    service: productpage
spec:
  type: NodePort
  ports:
  - port: 9080
    targetPort: 9080
    nodePort: 30080
    name: http
  selector:
    app: productpage

---
# details Service
apiVersion: v1
kind: Service
metadata:
  name: details
  namespace: bookinfo
  labels:
    app: details
    service: details
spec:
  ports:
  - port: 9080
    name: http
  selector:
    app: details

---
# ratings Service  
apiVersion: v1
kind: Service
metadata:
  name: ratings
  namespace: bookinfo
  labels:
    app: ratings
    service: ratings
spec:
  ports:
  - port: 9080
    name: http
  selector:
    app: ratings

---
# reviews Service
apiVersion: v1
kind: Service
metadata:
  name: reviews
  namespace: bookinfo
  labels:
    app: reviews
    service: reviews
spec:
  ports:
  - port: 9080
    name: http
  selector:
    app: reviews

---
# Placeholder for actual Bookinfo deployments
# 실제 Deployment manifest들은 EC2에서 bookinfo.yaml을 다운로드하여 추가될 예정
# curl -L https://raw.githubusercontent.com/istio/istio/release-1.20/samples/bookinfo/platform/kube/bookinfo.yaml 