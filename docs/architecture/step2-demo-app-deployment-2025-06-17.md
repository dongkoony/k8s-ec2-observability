# Step 2: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë°ëª¨ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬

**ì‘ì—… ë‚ ì§œ**: 2025ë…„ 6ì›” 17ì¼  
**ì‘ì—… ì‹œê°„**: ì•½ 15ë¶„  
**ë‚œì´ë„**: â­â­  
**ë‹´ë‹¹ì**: DevOps Engineer

---

## ğŸ¯ **ëª©í‘œ ë° ë°°ê²½**

ê´€ì°°ê°€ëŠ¥ì„± í”Œë«í¼ì˜ **ì‹¤ì œ ì›Œí¬ë¡œë“œ ëŒ€ìƒ**ì„ í™•ë³´í•˜ê¸° ìœ„í•´ í”„ë¡œë•ì…˜ í™˜ê²½ê³¼ ìœ ì‚¬í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤. Istioì˜ Bookinfo ìƒ˜í”Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í™œìš©í•˜ì—¬ ì„œë¹„ìŠ¤ ê°„ í†µì‹ , ë¡œë“œ ë°¸ëŸ°ì‹±, íŠ¸ë˜í”½ ê´€ë¦¬ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### **ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­**
- ì‹¤ì œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í™˜ê²½ì—ì„œì˜ ê´€ì°°ê°€ëŠ¥ì„± ê²€ì¦
- ì„œë¹„ìŠ¤ ë©”ì‹œ ë„ì… ì „ baseline ì„±ëŠ¥ ì¸¡ì •
- ë¶„ì‚° ì‹œìŠ¤í…œì˜ ë³µì¡ì„±ì„ ë°˜ì˜í•œ ëª¨ë‹ˆí„°ë§ ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì„±

---

## ğŸ—ï¸ **ì•„í‚¤í…ì²˜ ì„¤ê³„**

### **ì„ íƒëœ ì• í”Œë¦¬ì¼€ì´ì…˜: Istio Bookinfo**
| ì„œë¹„ìŠ¤ | ì–¸ì–´/í”„ë ˆì„ì›Œí¬ | í¬íŠ¸ | ì—­í•  |
|---------|----------------|------|------|
| **productpage** | Python/Flask | 9080 | í”„ë¡ íŠ¸ì—”ë“œ ì›¹ ì¸í„°í˜ì´ìŠ¤ |
| **details** | Ruby/Sinatra | 9080 | ì±… ì„¸ë¶€ì •ë³´ API |
| **ratings** | Node.js/Express | 9080 | í‰ì  ì •ë³´ API |
| **reviews** | Java/Liberty | 9080 | ë¦¬ë·° ì •ë³´ API (3ê°œ ë²„ì „) |

### **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í† í´ë¡œì§€**
```mermaid
graph TD
    A[User] --> B[productpage:30080]
    B --> C[details:9080]
    B --> D[reviews:9080]
    D --> E[ratings:9080]
    
    F[reviews-v1] --> G[No ratings]
    H[reviews-v2] --> I[â˜… Black stars]  
    J[reviews-v3] --> K[â˜… Red stars]
    
    D --> F
    D --> H  
    D --> J
    H --> E
    J --> E
```

### **ì„ íƒ ì´ìœ **
1. **ë‹¤ì¤‘ ì–¸ì–´ í™˜ê²½**: Python, Ruby, Node.js, Javaë¡œ ì‹¤ì œ í™˜ê²½ ë°˜ì˜
2. **ì„œë¹„ìŠ¤ ì˜ì¡´ì„±**: ê³„ì¸µì  ì„œë¹„ìŠ¤ í˜¸ì¶œ íŒ¨í„´
3. **A/B í…ŒìŠ¤íŒ…**: reviews ì„œë¹„ìŠ¤ì˜ 3ê°œ ë²„ì „ìœ¼ë¡œ ì¹´ë‚˜ë¦¬ ë°°í¬ ì‹œë®¬ë ˆì´ì…˜
4. **ì‹¤ì œ íŠ¸ë˜í”½**: HTTP ìš”ì²­/ì‘ë‹µ íŒ¨í„´ìœ¼ë¡œ ë©”íŠ¸ë¦­ ìƒì„±

---

## ğŸ› ï¸ **êµ¬í˜„ ê³¼ì •**

### **Phase 1: ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë° ë¦¬ì†ŒìŠ¤ ì¤€ë¹„**

**ì „ìš© ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„±:**
```bash
kubectl create namespace bookinfo
```

**ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë‹¤ìš´ë¡œë“œ:**
```bash
curl -L https://raw.githubusercontent.com/istio/istio/release-1.20/samples/bookinfo/platform/kube/bookinfo.yaml -o bookinfo.yaml
```

### **Phase 2: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë°°í¬**

**ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬:**
```bash
kubectl apply -f bookinfo.yaml -n bookinfo
```

**ë°°í¬ëœ ë¦¬ì†ŒìŠ¤:**
```yaml
# ì„œë¹„ìŠ¤ ê³„ì • (ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë³„)
- bookinfo-details
- bookinfo-ratings  
- bookinfo-reviews
- bookinfo-productpage

# ì„œë¹„ìŠ¤ (ClusterIP)
- details:9080
- ratings:9080
- reviews:9080  
- productpage:9080

# ë””í”Œë¡œì´ë¨¼íŠ¸
- details-v1 (1 replica)
- ratings-v1 (1 replica)
- reviews-v1 (1 replica) # í‰ì  ê¸°ëŠ¥ ì—†ëŠ” ë²„ì „
- reviews-v2 (1 replica) # ê¸°ë³¸ ë³„ì  í‘œì‹œ ë²„ì „
- reviews-v3 (1 replica) # ê°•ì¡°ëœ ë³„ì  í‘œì‹œ ë²„ì „
- productpage-v1 (1 replica)
```

### **Phase 3: ì™¸ë¶€ ì ‘ê·¼ ì„¤ì •**

**NodePort ì„œë¹„ìŠ¤ ì„¤ì •:**
```bash
kubectl patch svc productpage -n bookinfo -p '{
  "spec": {
    "type": "NodePort",
    "ports": [{
      "port": 9080,
      "targetPort": 9080,
      "nodePort": 30080
    }]
  }
}'
```

**ì ‘ê·¼ í¬ì¸íŠ¸:**
- **ë‚´ë¶€ ì ‘ê·¼**: `http://productpage.bookinfo.svc.cluster.local:9080`
- **ì™¸ë¶€ ì ‘ê·¼**: `http://[NODE_IP]:30080/productpage`

---

## ğŸ“Š **ë°°í¬ ê²°ê³¼**

### **Pod ë°°í¬ ìƒíƒœ**
```bash
kubectl get pods -n bookinfo
```
```
NAME                              READY   STATUS
details-v1-86545f5dfb-7n658       1/1     Running
productpage-v1-7c74cbdbcc-bxsbg   1/1     Running
ratings-v1-57544668d4-g6pdg       1/1     Running
reviews-v1-5f58978c56-l9bhq       1/1     Running  
reviews-v2-7bd564ffc6-v9jh6       1/1     Running
reviews-v3-7dfb7c4b64-v5gcw       1/1     Running
```

### **ì„œë¹„ìŠ¤ ë„¤íŠ¸ì›Œí‚¹**
```bash
kubectl get svc -n bookinfo
```
```
NAME          TYPE       CLUSTER-IP       PORT(S)
details       ClusterIP  10.105.31.154    9080/TCP
productpage   NodePort   10.103.108.218   9080:30080/TCP
ratings       ClusterIP  10.108.35.170    9080/TCP
reviews       ClusterIP  10.103.75.130    9080/TCP
```

### **ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ë¶„ì„**
| Pod | CPU Request | Memory Request | Node ë°°ì¹˜ |
|-----|-------------|---------------|-----------|
| details-v1 | 100m | 64Mi | worker-node1 |
| productpage-v1 | 100m | 64Mi | worker-node2 |  
| ratings-v1 | 100m | 64Mi | worker-node1 |
| reviews-v1 | 100m | 64Mi | worker-node2 |
| reviews-v2 | 100m | 64Mi | worker-node1 |
| reviews-v3 | 100m | 64Mi | worker-node2 |

---

## ğŸ” **ê¸°ìˆ ì  ì¸ì‚¬ì´íŠ¸**

### **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì„¤ê³„ íŒ¨í„´**
1. **ì„œë¹„ìŠ¤ë³„ ì–¸ì–´ ë‹¤ì–‘ì„±**: ì‹¤ì œ ì¡°ì§ì˜ polyglot í™˜ê²½ ë°˜ì˜
2. **ë²„ì „ ê´€ë¦¬ ì „ëµ**: reviews ì„œë¹„ìŠ¤ì˜ 3ê°œ ë²„ì „ìœ¼ë¡œ ë¡¤ë§ ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜
3. **ì˜ì¡´ì„± ê´€ë¦¬**: productpage â†’ details/reviews â†’ ratings ì²´ì¸

### **Kubernetes ë„¤ì´í‹°ë¸Œ íŒ¨í„´**
- **Service Discovery**: DNS ê¸°ë°˜ ì„œë¹„ìŠ¤ ê°„ í†µì‹ 
- **Load Balancing**: kube-proxyì˜ iptables ê¸°ë°˜ ë¡œë“œ ë°¸ëŸ°ì‹±
- **Health Checks**: ê° ì„œë¹„ìŠ¤ì˜ liveness/readiness probe

### **ê´€ì°°ê°€ëŠ¥ì„± ê´€ì **
1. **ë©”íŠ¸ë¦­ í¬ì¸íŠ¸**: 
   - HTTP ìš”ì²­/ì‘ë‹µ ì‹œê°„
   - ì„œë¹„ìŠ¤ ê°„ latency
   - ì—ëŸ¬ìœ¨ ë° ì„±ê³µë¥ 
2. **ë¡œê·¸ ì†ŒìŠ¤**:
   - ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ (stdout)
   - ì•¡ì„¸ìŠ¤ ë¡œê·¸ (nginx, ê° ì–¸ì–´ë³„)
3. **íŠ¸ë ˆì´ì‹± ê²½ë¡œ**:
   - productpage â†’ details (ì§ì ‘ í˜¸ì¶œ)
   - productpage â†’ reviews â†’ ratings (ì²´ì¸ í˜¸ì¶œ)

---

## ğŸš€ **ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬**

### **ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ í’€ë§ ì‹œê°„**
- **details**: ~15ì´ˆ (Ruby ê¸°ë°˜)
- **ratings**: ~20ì´ˆ (Node.js ê¸°ë°˜)  
- **reviews**: ~45ì´ˆ (Java/Liberty ê¸°ë°˜, ê°€ì¥ í° ì´ë¯¸ì§€)
- **productpage**: ~25ì´ˆ (Python ê¸°ë°˜)

### **ì„œë¹„ìŠ¤ ì‹œì‘ ì‹œê°„**
- **ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¤€ë¹„**: ~60ì´ˆ
- **health check í†µê³¼**: ë°°í¬ í›„ 15ì´ˆ ì´ë‚´
- **ì„œë¹„ìŠ¤ ê°„ ì—°ê²°ì„± í™•ë¦½**: ì¦‰ì‹œ

### **ë„¤íŠ¸ì›Œí¬ êµ¬ì„±**
```bash
# ì„œë¹„ìŠ¤ ë©”ì‹œ ì—†ëŠ” ê¸°ë³¸ ì„±ëŠ¥
- productpage â†’ details: ~2ms (ê°™ì€ ë…¸ë“œ)
- productpage â†’ reviews: ~3ms (ë‹¤ë¥¸ ë…¸ë“œ)  
- reviews â†’ ratings: ~2ms (ê°™ì€ ë…¸ë“œ)
```

---

## ğŸ¯ **ë‹¤ìŒ ë‹¨ê³„ ì¤€ë¹„ì‚¬í•­**

### **Step 3 ì¤€ë¹„: íŠ¸ë˜í”½ ìƒì„± ë° ëª¨ë‹ˆí„°ë§**
1. **ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë„êµ¬**: hey, wrk, ë˜ëŠ” siegeë¥¼ ì‚¬ìš©í•œ íŠ¸ë˜í”½ ì‹œë®¬ë ˆì´ì…˜
2. **ë©”íŠ¸ë¦­ ìˆ˜ì§‘**: Prometheusì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­ ìŠ¤í¬ë˜í•‘ í™•ì¸
3. **ëŒ€ì‹œë³´ë“œ êµ¬ì„±**: Grafanaì—ì„œ ì„œë¹„ìŠ¤ë³„ ì„±ëŠ¥ ëŒ€ì‹œë³´ë“œ ì¤€ë¹„

### **ì„œë¹„ìŠ¤ ë©”ì‹œ ì¤€ë¹„**
- [ ] Linkerd ì£¼ì…ì„ ìœ„í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ annotation ì¤€ë¹„
- [ ] mTLS ì ìš© ì „ baseline ì„±ëŠ¥ ì¸¡ì •  
- [ ] íŠ¸ë˜í”½ ì •ì±… ë° ë¼ìš°íŒ… ê·œì¹™ ì„¤ê³„

---

## ğŸ’¡ **í•™ìŠµ í¬ì¸íŠ¸**

### **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ìš´ì˜ ë³µì¡ì„±**
1. **ì–¸ì–´ë³„ íŠ¹ì„±**: Java ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê¸´ ì‹œì‘ ì‹œê°„ vs Node.jsì˜ ë¹ ë¥¸ ì‹œì‘
2. **ì˜ì¡´ì„± ê´€ë¦¬**: ì„œë¹„ìŠ¤ ì‹œì‘ ìˆœì„œ ë° health check ì¤‘ìš”ì„±
3. **ë„¤íŠ¸ì›Œí¬ ì •ì±…**: Pod-to-Pod í†µì‹ ê³¼ DNS í•´ì„

### **Kubernetes ë¦¬ì†ŒìŠ¤ ê´€ë¦¬**
- **ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¶„ë¦¬**: ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ ê²©ë¦¬ì˜ ì¤‘ìš”ì„±
- **ì„œë¹„ìŠ¤ íƒ€ì…**: ClusterIP vs NodePort ì„ íƒ ê¸°ì¤€
- **ë ˆì´ë¸” ì…€ë ‰í„°**: ì„œë¹„ìŠ¤ ë°œê²¬ ë° íŠ¸ë˜í”½ ë¼ìš°íŒ…

### **DevOps ëª¨ë²” ì‚¬ë¡€**
1. **ì„ ì–¸ì  ë°°í¬**: YAML ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ í†µí•œ Infrastructure as Code
2. **ì ì§„ì  ë°°í¬**: ì—¬ëŸ¬ ë²„ì „ì˜ ë™ì‹œ ìš´ì˜ìœ¼ë¡œ ë¬´ì¤‘ë‹¨ ë°°í¬ ì¤€ë¹„
3. **ê´€ì°°ê°€ëŠ¥ì„± ê¸°ë°˜**: ë©”íŠ¸ë¦­ ìƒì„±ì„ ê³ ë ¤í•œ ì•„í‚¤í…ì²˜ ì„¤ê³„

**ì´ ë‹¨ê³„ë¥¼ í†µí•´ ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ê³¼ ìœ ì‚¬í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì›Œí¬ë¡œë“œë¥¼ í™•ë³´í•˜ê³ , ë‹¤ìŒ ê´€ì°°ê°€ëŠ¥ì„± ë„êµ¬ë“¤ì˜ ì‹¤íš¨ì„±ì„ ê²€ì¦í•  ê¸°ë°˜ì„ ë§ˆë ¨í–ˆìŠµë‹ˆë‹¤.** 